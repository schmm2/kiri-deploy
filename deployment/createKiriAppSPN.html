Invoke-Command {<br />$AppName=\"svc-kiriapp\"<br />$SpaBody = \"{spa:{redirectUris:[&apos;https://',basics('siteName'),'.azurewebsites.net&apos;]}}\"
<br />$RequiredGrantsApp = [Microsoft.Open.AzureAD.Model.RequiredResourceAccess]::new(\"00000003-0000-0000-c000-000000000000\",@([Microsoft.Open.AzureAD.Model.ResourceAccess]::new(\"e1fe6dd8-ba31-4d61-89e7-88639da4683d\",\"Scope\"),[Microsoft.Open.AzureAD.Model.ResourceAccess]::new(\"b340eb25-3456-403f-be2f-af7a0d370277\",\"Scope\")))
<br />$RequiredGrantsApi =[Microsoft.Open.AzureAD.Model.RequiredResourceAccess]::new(\"',steps('ServicePrincipalAPI').spIdAPI,'\",@([Microsoft.Open.AzureAD.Model.ResourceAccess]::new(\"68ce7e13-ac30-4979-b2c5-6334ef2f70ef\",\"Scope\")))
<br /><br />Connect-AzureAD<br /><br />$App=New-AzureADApplication -DisplayName $AppName -AvailableToOtherTenants $true -GroupMembershipClaims \"SecurityGroup\" -RequiredResourceAccess @($RequiredGrantsApi, $RequiredGrantsApp)
<br />$AppRestUrl = \"https://graph.microsoft.com/v1.0/applications/\" + $App.ObjectId
</br>az rest --method PATCH --uri $AppRestUrl --headers \"Content-Type=application/json\" --body $SpaBody
</br>write-host \"--------------------------------------------------------------------------\"<br />write-host \"Application Id: $($app.AppId)\"<br />write-host \"--------------------------------------------------------------------------\"}